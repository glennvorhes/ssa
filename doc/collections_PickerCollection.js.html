<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: collections/PickerCollection.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: collections/PickerCollection.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Created by gavorhes on 5/16/2016.
 */


import SelectStartCounty from '../selectBox/SelectStartCounty';
import SelectHighway from '../selectBox/SelectHighway';
import SelectEndCounty from '../selectBox/SelectEndCounty';
import SegmentPickerFrom from '../segmentPicker/SegmentPickerFrom';
import SegmentPickerTo from '../segmentPicker/SegmentPickerTo';
import Corridor from '../corridor/Corridor';
import provide from 'webmapsjs/src/util/provide'
import $ from 'webmapsjs/src/jquery/jquery';
import * as lyrStyles from '../layerStyles';
const nm = provide('ssa');

class PickerCollection {

    /**
     *
     * @param {string} divId
     * @param {SsaMapCreate} ssaMapCreate
     */
    constructor(divId, ssaMapCreate) {
        this._ssaMapCreate = ssaMapCreate;
        this.$containerEl = $('#' + divId).addClass('picker-collection-container');
        this.$containerEl.append('&lt;div class="picker-collection">&lt;span class="corridor-picker-help" title="Show Help">&lt;/span>&lt;/div>');
        this.$containerEl.append('&lt;input type="button" value="Preview" class="btn btn-default picker-preview">');
        this.$containerEl.append('&lt;input type="button" value="Add" class="btn btn-default picker-add" disabled="disabled">');
        this.$containerEl.append('&lt;input type="button" value="Modify" class="btn btn-default picker-modify" disabled="disabled" style="display: none;">');
        this.$containerEl.append('&lt;input type="button" value="Cancel" class="btn btn-default picker-cancel">');
        this.$innerContainer = this.$containerEl.find('.picker-collection');
        this._visible = false;

        this._dummyCorridor = new Corridor(1, 1, '', '', 1, 1, 'h', {
            cancelLoad: true,
            color: lyrStyles.corridorPreviewColor
        });
        this._dummyCorridor.layer.zIndex = 10;
        this._ssaMapCreate.mainMap.addLayer(this._dummyCorridor.olLayer);

        this._addModifyEnabled = false;

        /**
         *
         * @type {Corridor|undefined}
         * @private
         */
        this._modifyCorridor = undefined;


        this.$btnPickerPreview = this.$containerEl.find('.picker-preview');
        this.$btnPickerAdd = this.$containerEl.find('.picker-add');
        this.$btnPickerModify = this.$containerEl.find('.picker-modify');
        this.$btnPickerCancel = this.$containerEl.find('.picker-cancel');


        this.countyStartSelect = new SelectStartCounty(this.$innerContainer);
        this.countyEndSelect = new SelectEndCounty(this.$innerContainer);
        this.highwaySelect = new SelectHighway(this.$innerContainer);

        this.segmentPickerFrom = new SegmentPickerFrom(this.$innerContainer);
        this.segmentPickerTo = new SegmentPickerTo(this.$innerContainer);

        this.segmentPickerFrom.otherPicker = this.segmentPickerTo;
        this.segmentPickerTo.otherPicker = this.segmentPickerFrom;

        this.$btnPickerCancel.click(() => {
            this.cancel();
        });

        this.$btnPickerPreview.click(() => {
            this.previewCorridor();
        });

        this.$btnPickerAdd.click(() => {
            this.addCorridor();
        });

        this.$btnPickerModify.click(() => {
            this.modifyCorridor();
        });


        this.countyStartSelect.addChangeListener((v) => {
            "use strict";

            this.highwaySelect.setStartEndCounty(v, this.countyEndSelect.selectedValue);
            this.addModifyEnabled = false;
        });

        this.countyEndSelect.addChangeListener((v) => {
            "use strict";
            this.highwaySelect.setStartEndCounty(this.countyStartSelect.selectedValue, v);
            this.addModifyEnabled = false;
        });

        this.highwaySelect.addChangeListener((hwy) => {
            "use strict";
            this.segmentPickerFrom.setCountyAndRoute(this.countyStartSelect.selectedValue, hwy);
            this.segmentPickerTo.setCountyAndRoute(this.countyEndSelect.selectedValue, hwy);
            this.addModifyEnabled = false;
        });
        
        this.segmentPickerFrom.addChangeListener((v) => {
            this.addModifyEnabled = false;
        });

        this.segmentPickerTo.addChangeListener((v) => {
            this.addModifyEnabled = false;
        });

        $(document).click((event) => {
            let containerClass = 'select-picker-map-container';
            let evtTarget = $(event.target);

            if (evtTarget.parents('.' + containerClass).length == 0 &amp;&amp; !evtTarget.hasClass(containerClass)) {
                this.segmentPickerFrom.visible = false;
                this.segmentPickerTo.visible = false;
            }
        });

        let helpInfo = 'Corridors are defined by selecting in sequence the start county, highway, and end county ';
        helpInfo += "The reference points are then populated and can be selected either by using the combo box or ";
        helpInfo += "by clicking a segment in the map and clicking select in the resulting popup ";
        helpInfo += "Corridors are defined visually in the pickers as the start segment (green) and end segment (red) ";
        helpInfo += "inclusive of the corridor extents";

        $('body').append(`&lt;div class="corridor-picker-help-dialog" title="Corridor Selection Help">` +
            `&lt;p style="text-align: justify">${helpInfo}&lt;/p>&lt;/div>`);


        this.helpDialog = $(".corridor-picker-help-dialog");

        this.helpDialog.dialog({
            modal: true,
            autoOpen: false,
            height: 450,
            width: 650,
            buttons: [
                {
                    text: "OK",
                    click: function () {
                        $(this).dialog("close");
                    }
                }
            ]
        });

        this.$containerEl.find('.corridor-picker-help').click(() => {
            this.helpDialog.dialog('open');
        });
    }

    cancel() {
        this.$btnPickerAdd.show();
        this.$btnPickerModify.hide();
        this.$btnPickerModify.prop('disabled', true);
        this.visible = false;
        this._ssaMapCreate.$createCorridorButton.prop('disabled', false);
        // this.countyStartSelect.box.val(1).trigger('change');
        this._ssaMapCreate.corridorCollection.visible = true;
        this._dummyCorridor.layer.clear();
        this._modifyCorridor = undefined;
        this._dummyCorridor.nodeLayer.olLayer.getSource().clear();
        this.addModifyEnabled = false;
        this._ssaMapCreate.corridorCollection.createModifyOperation = false;
        $('.corridor-tr-selected').removeClass('corridor-tr-selected');
    }

    previewCorridor() {
        if (!this.segmentPickerFrom.selectedPdpId || !this.segmentPickerTo.selectedPdpId) {
            alert('Select From and To Reference Points');
            return;
        }

        this._ssaMapCreate.mainMap.removeLayer(this._dummyCorridor.layer.olLayer);
        this._ssaMapCreate.mainMap.removeLayer(this._dummyCorridor.nodeLayer.olLayer);
        this._dummyCorridor = new Corridor(
            this.segmentPickerFrom.selectedPdpId,
            this.segmentPickerTo.selectedPdpId,
            this.segmentPickerFrom.selectedText,
            this.segmentPickerTo.selectedText,
            this.countyStartSelect.selectedValue,
            this.countyEndSelect.selectedValue,
            this.highwaySelect.selectedText,
            {
                cancelLoad: true,
                color: lyrStyles.corridorPreviewColor
            }
        );


        this._dummyCorridor.layer.olLayer.zIndex = 10;
        this._ssaMapCreate.mainMap.addLayer(this._dummyCorridor.layer.olLayer);
        this._ssaMapCreate.mainMap.addLayer(this._dummyCorridor.nodeLayer.olLayer);

        this._dummyCorridor.load((c) => {
            //TODO better implementation for an early break
            // if (c.valid) {
            //     this._ssaMapCreate.mainMap.getView().fit(c.extent, this._ssaMapCreate.mainMap.getSize());
            //     this.addModifyEnabled = true;
            // } else {
            //     alert(c.error);
            // }
            this._ssaMapCreate.mainMap.getView().fit(c.extent, this._ssaMapCreate.mainMap.getSize());
            this.addModifyEnabled = true;

        });

    }

    addCorridor() {
        this._ssaMapCreate.corridorCollection.addCorridorCreate(this._dummyCorridor.clone());
        this.cancel();
    }

    modifyCorridor() {
        this._modifyCorridor.updateCorridor(this._dummyCorridor);
        this._ssaMapCreate.corridorCollection.refreshHtmlCreate();
        this.cancel();
    }

    /**
     *
     * @param {Corridor} cor
     */
    startEditCorridor(cor) {
        this.visible = true;
        this.$btnPickerAdd.hide();
        this.$btnPickerModify.show();
        this.countyStartSelect.box.val(cor.countyStart);
        this.countyEndSelect.box.val(cor.countyEnd);
        // this.highwaySelect.setStartCounty(cor.countyStart, cor.highway);
        this.highwaySelect.setStartEndCounty(cor.countyStart, cor.countyEnd, cor.highway);
        
        this.segmentPickerFrom.setCountyAndRoute(cor.countyStart, cor.highway, cor.pdpFrom);
        this.segmentPickerTo.setCountyAndRoute(cor.countyEnd, cor.highway, cor.pdpTo);

        this._modifyCorridor = cor;

        this._dummyCorridor.updateCorridor(cor);

        this._ssaMapCreate.mainMap.getView().fit(this._dummyCorridor.extent, this._ssaMapCreate.mainMap.getSize());
        this._ssaMapCreate.corridorCollection.createModifyOperation = true;
    }

    get visible() {
        return this._visible;
    }

    set visible(viz) {
        this._visible = viz;

        if (this.visible) {
            this.$containerEl.show();
        } else {
            this.$containerEl.hide();
        }
    }

    /**
     *
     * @returns {boolean}
     */
    get addModifyEnabled() {
        return this._addModifyEnabled;
    }

    /**
     *
     * @param {boolean} isEnabled
     */
    set addModifyEnabled(isEnabled) {
        this._addModifyEnabled = isEnabled;
        this.$btnPickerAdd.prop('disabled', !this.addModifyEnabled);
        this.$btnPickerModify.prop('disabled', !this.addModifyEnabled);
    }
}

nm.PickerCollection = PickerCollection;
export default PickerCollection;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Corridor.html">Corridor</a></li><li><a href="CorridorCollection.html">CorridorCollection</a></li><li><a href="CorridorConfig.html">CorridorConfig</a></li><li><a href="PickerCollection.html">PickerCollection</a></li><li><a href="SegmentPickerBase.html">SegmentPickerBase</a></li><li><a href="SegmentPickerFrom.html">SegmentPickerFrom</a></li><li><a href="SegmentPickerTo.html">SegmentPickerTo</a></li><li><a href="SelectBoxBase.html">SelectBoxBase</a></li><li><a href="SelectCounty.html">SelectCounty</a></li><li><a href="SelectEndCounty.html">SelectEndCounty</a></li><li><a href="SelectHighway.html">SelectHighway</a></li><li><a href="SelectStartCounty.html">SelectStartCounty</a></li><li><a href="SsaMapCreate.html">SsaMapCreate</a></li><li><a href="SsaMapView.html">SsaMapView</a></li></ul><h3>Global</h3><ul><li><a href="global.html#_dteStrip">_dteStrip</a></li><li><a href="global.html#ajaxHelper">ajaxHelper</a></li><li><a href="global.html#ajaxInner">ajaxInner</a></li><li><a href="global.html#calculateExtent">calculateExtent</a></li><li><a href="global.html#getAllCounties">getAllCounties</a></li><li><a href="global.html#getCorridor">getCorridor</a></li><li><a href="global.html#getCountyById">getCountyById</a></li><li><a href="global.html#getCrashes">getCrashes</a></li><li><a href="global.html#getEndCounties">getEndCounties</a></li><li><a href="global.html#getHighways">getHighways</a></li><li><a href="global.html#getHwyByStartEndCounty">getHwyByStartEndCounty</a></li><li><a href="global.html#getSegments">getSegments</a></li><li><a href="global.html#getStartCounties">getStartCounties</a></li><li><a href="global.html#layerConfigHelper">layerConfigHelper</a></li><li><a href="global.html#randomColor">randomColor</a></li><li><a href="global.html#returnedColors">returnedColors</a></li><li><a href="global.html#tableContent">tableContent</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jun 15 2016 16:06:27 GMT-0500 (Central Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
